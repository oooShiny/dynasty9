{#
/**
 * @file
 * Theme override to display a Play entity.
 *
 * Available variables:
 * - play: The play entity.
 * - content: All play items.
 * - attributes: HTML attributes for the containing element.
 * - title_attributes: HTML attributes for the title.
 * - content_attributes: HTML attributes for the content wrapper.
 */
#}
<div{{ attributes.addClass('play-item', 'mb-4', 'p-4', 'border', 'border-gray-300', 'rounded-lg', 'bg-white', 'shadow-sm') }}>
  {# Quarter and Time Badge #}
  {% if content.quarter or content.minutes or content.seconds %}
    <div class="play-meta mb-2 flex items-center gap-2 flex-wrap">
      {% if content.quarter %}
        <span class="badge badge-primary text-xs font-bold px-2 py-1 rounded bg-blue-600 text-white">
          {{ content.quarter }}
        </span>
      {% endif %}
      {% if content.minutes or content.seconds %}
        <span class="play-time text-sm text-gray-600 font-mono">
          {{ content.minutes|render|trim }}:{{ '%02d'|format(content.seconds|render|trim) }}
        </span>
      {% endif %}
      {% if content.scoring_team %}
        <span class="scoring-team text-sm font-semibold text-gray-700">
          {{ content.scoring_team }}
        </span>
      {% endif %}
      {# Scoring Play Badge #}
      {% if play.scoring_play.value %}
        <span class="badge badge-success text-xs font-bold px-2 py-1 rounded bg-green-600 text-white">
          SCORE
        </span>
      {% endif %}
      {# Turnover Badge #}
      {% if play.turnover.value %}
        <span class="badge badge-error text-xs font-bold px-2 py-1 rounded bg-red-600 text-white">
          TURNOVER
        </span>
      {% endif %}
    </div>
  {% endif %}

  {# Play Description #}
  {% if content.play_description %}
    <div class="play-description text-base mb-2">
      {{ content.play_description }}
    </div>
  {% endif %}

  {# Distance Badge #}
  {% if content.distance %}
    <div class="play-distance text-sm text-gray-600 mb-2">
      <span class="badge badge-outline text-xs px-2 py-1 rounded border border-gray-400">
        {{ content.distance }} yards
      </span>
    </div>
  {% endif %}

  {# Highlight Reference #}
  {% if play.play_highlight.entity %}
    {% set highlight = play.play_highlight.entity %}
    {% set video_id = highlight.field_muse_video_id.value %}
    {% if video_id %}
      {% set modal_id = 'video_modal_' ~ play.id.value %}
      <div class="play-highlight mt-2 pt-2 border-t border-gray-200">
        <button
          onclick="document.getElementById('{{ modal_id }}').showModal()"
          class="btn btn-sm btn-primary gap-2"
          aria-label="Play highlight video for {{ highlight.label }}">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
          </svg>
          Watch Highlight
        </button>

        {# DaisyUI Modal #}
        <dialog id="{{ modal_id }}" class="modal">
          <div class="modal-box w-11/12 max-w-5xl p-0">
            <form method="dialog">
              <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2 z-10">âœ•</button>
            </form>
            <h3 class="font-bold text-lg p-4 pb-2">{{ highlight.label }}</h3>
            <div class="aspect-video w-full">
              <iframe
                src="https://muse.ai/embed/{{ video_id }}?auto=0"
                frameborder="0"
                allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen
                class="w-full h-full"
                title="{{ highlight.label }}"></iframe>
            </div>
          </div>
          <form method="dialog" class="modal-backdrop">
            <button>close</button>
          </form>
        </dialog>
      </div>
    {% else %}
      {# Fallback if no video ID #}
      <div class="play-highlight mt-2 pt-2 border-t border-gray-200">
        <span class="text-sm text-gray-500 mr-2">Highlight:</span>
        {{ content.play_highlight }}
      </div>
    {% endif %}
  {% endif %}
</div>
